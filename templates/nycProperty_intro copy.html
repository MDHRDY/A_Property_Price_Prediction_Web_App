<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css"/>
	<!-- If IE use the latest rendering engine -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- Set the page to the width of the device and set the zoon level -->
	<meta name="viewport" content="width = device-width, initial-scale = 1">
	<title>City Property</title>
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link href="style.css" rel="stylesheet">
</head>

<body>
  <div class="container">
  <div class="row">
	<div class="col-sm-12 jumbotron">
		<div class="text-center">
			<h1> City Property <h1>
  		</div>
	</div>
  </div>
  </div>
 <div class="container">
 <div class="row">
 	
   		<!--<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12"> --!>
   		<h1></h1>
		<h3> Location, location, location! </h3>
			We've all heard it.
	
			A good school district in the suburbs will lift the value of all homes in that district, but the rules differ in cities,
			where the effect of location on property values acts on much smaller scales. 
	 
			For example, a subway line confers 
			significantly more value to an apartment that is four blocks away than one that is fifteen. 
   
			If the same subway line is above ground however, 
			it could depreciate the value of apartments (Oh, the noise! Shut those windows after showering.) that are only steps away. 
		
		<p></p>
		
		<p>	Sorting out all of the local location-based contributions (proximity to parks, restaurants, shops, etc.) to city property values is a task 
			that has been glossed over by traditional metrics that often average values over large
			areas - such as a neighborhoods, counties, or zipcodes. There's probably a good reason for this: to understand small-scale influences, 
			a bunch of additional details  might need to be factored into the standard calculations, and presumably, this was
			traditionally unfeasible. </p>
 
		<p>	Fortunately, we now have 21st-century computing power at our fingertips, and we can use machine learning to sort out 
			differences between two properties that might differ in location by only a two minute walk. 
		</p>

		<A NAME="prediction"></A>

		<h3>Try it out:</h3>
		<A NAME="prediction2"></A>

		<p>	As a test case, we'll start with properties in New York City. Find the value of a property by entering
			an address in the search field below.
		<A NAME="prediction3"></A>


		<div class="container2">
		<div class="jumbotron jumbotron-body">
			<div class="col-lg-10 col-md-10 col-sm-12">

				<form id='userinfoform_lulu2' method='post' action='nycProperty_auto.html#prediction' >

				<button type="submit" class="btn btn-primary btn-md">Search</button>
				<span class="input-group-btn">
					<input id="place-input" type="text" class="form-control" name='address' placeholder="Enter an NYC Address">
					</input>
				</span>
			</div>
			</form>
		</div>
		</div>

		<div id="mapAuto"></div>


		<div class="container2">
			<div class="jumbotron2">
		<!--		<h4> {{num[0]}}  {{num[1]}} </h4> 
				<h4> {{num[2]}}  {{num[3]}} </h4> 
				<h4> {{num[4]}}  {{num[5]}} </h4> 
				<h4> {{num[6]}}  {{num[7]}} </h4> 
				<h4> {{num[8]}}  {{num[9]}} </h4>  --!>
			</div>
		</div>


<!-- seam to nead async defer --!>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBkuO8yMgbJ3RfHtCfUOT3aLHlhX3HkQsQ&libraries=places&callback=initMap"
  async defer ></script> 


	
		<div id="mapMultLoc"></div>
		
<script>
function initMap() {

	/*** for embedded map ***/
	var pass_coord = ['{{center_lat}}', '{{center_long}}' ];

	
	var property1 = {
		info: '<strong> ' + '{{d[0][2]}}' + '</strong><br>\r\
					Year of Sale: ' + '{{d[0][3]}}'+ '<br> Sale Price: ' + '{{d[0][4]}}' + '<br>',
		lat: {{num[0]}},
		long: {{num[1]}} /***-73.9027923602 ***/
	};

	var property2 = {
		info: '<strong> ' + '{{d[1][2]}}' + '</strong><br>\r\
					Year of Sale: ' + '{{d[1][3]}}'+ '<br> Sale Price: ' + '{{d[1][4]}}' + '<br>',
		lat: {{num[2]}},
		long:{{num[3]}}
	};

	var property3 = {
		info: '<strong> ' + '{{d[2][2]}}' + '</strong><br>\r\
					Year of Sale: ' + '{{d[2][3]}}'+ '<br> Sale Price: ' + '{{d[2][4]}}' + '<br>',
		lat: {{num[4]}},
		long: {{num[5]}} /***-73.9016901473 ***/
	};

	var property4 = {
		info: '<strong> ' + '{{d[3][2]}}' + '</strong><br>\r\
					Year of Sale: ' + '{{d[3][3]}}'+ '<br> Sale Price: ' + '{{d[3][4]}}' + '<br>',
		lat: {{num[6]}},
		long: {{num[7]}} /***-73.902, ***/
	};

	var property5 = {
		info: '<strong> ' + '{{d[4][2]}}' + '</strong><br>\r\
					Year of Sale: ' + '{{d[4][3]}}'+ '<br> Sale Price: ' + '{{d[4][4]}}' + '<br>',
		lat: {{num[8]}},
		long: {{num[9]}} /***-73.902, ***/
	};

	var property6 = {
		info: '<strong> ' + '{{d[5][2]}}' + '</strong><br>\r\
					Year of Sale: ' + '{{d[5][3]}}'+ '<br> Sale Price: ' + '{{d[5][4]}}' + '<br>',
		lat: {{num[10]}},
		long: {{num[11]}} /***-73.902, ***/
	};
	
	var property7 = {
		info: '<strong> ' + '{{d[6][2]}}' + '</strong><br>\r\
					Year of Sale: ' + '{{d[6][3]}}'+ '<br> Sale Price: ' + '{{d[6][4]}}' + '<br>',
		lat: {{num[12]}},
		long: {{num[13]}} /***-73.902, ***/
	};

	var property8 = {
		info: '<strong> ' + '{{d[7][2]}}' + '</strong><br>\r\
					Year of Sale: ' + '{{d[7][3]}}'+ '<br> Sale Price: ' + '{{d[7][4]}}' + '<br>',
		lat: {{num[14]}},
		long: {{num[15]}} /***-73.902, ***/
	};

	var locations = [
      [property1.info,  property1.lat, property1.long, 0], 
      [property2.info,  property2.lat, property2.long, 1], 
      [property3.info,  property3.lat, property3.long, 2], 
      [property4.info,  property4.lat, property4.long, 3], 
      [property5.info,  property5.lat, property5.long, 4], 
      [property6.info,  property6.lat, property6.long, 5], 
      [property7.info,  property7.lat, property7.long, 6], 
      [property8.info,  property8.lat, property8.long, 6], 

    ];
		

	var map2 = new google.maps.Map(document.getElementById('mapMultLoc'), {
		zoom: {{zoom}},
		center: new google.maps.LatLng( {{num[4]}},{{num[5]}}), /***      40.839, -73.902), ***/
		mapTypeId: google.maps.MapTypeId.ROADMAP
	});

	var infowindow2 = new google.maps.InfoWindow({});

	var marker2, i;
	
	for (i = 0; i < {{length}}; i++) {
		marker2 = new google.maps.Marker({
			position: new google.maps.LatLng(locations[i][1], locations[i][2]),
			map: map2
		});

		google.maps.event.addListener(marker2, 'click', (function (marker2, i) {
			return function () {
				infowindow2.setContent(locations[i][0]);
				infowindow2.open(map2, marker2);
			}
		})(marker2, i));
	} /*** end embedded map ***/
	
	/*** for autocomplete ***/
	var map = new google.maps.Map(document.getElementById('mapAuto'), {
	  center: {lat: 40.71, lng: -74.02},
	  zoom: {{zoom}}
	});
	var input = /** @type {!HTMLInputElement} */(
		document.getElementById('place-input'));

	var autocomplete = new google.maps.places.Autocomplete(input);
	autocomplete.bindTo('bounds', map);

	autocomplete.addListener('place_changed', function() {
	  infowindow.close();
	  marker.setVisible(false);
	  var place = autocomplete.getPlace();
	  if (!place.geometry) {
		window.alert("Autocomplete's returned place contains no geometry");
		return;
	  }
	}); /*** end autocomplete ***/
	
} /*** end initMap2() ***/
	
</script>



			<p>  Websites like Trulia or Zillow have aided buyers and investors by providing a free snapshot of current market listing prices 
			and some traditional metrics (like median home value), but 
			in order to make an informed decision about the value of a property and how it is expected to change over time, we'd want more information. </p>
			<p>The 'location' maxim is tough to sort out in cities because it only holds on more granular levels. A good school 
			district in the suburbs will lift the value of all homes in that district, which might spans a number of miles. 
			In cities however, levers act on much smaller scales. A subway line, for example, will confer significantly more value to an 
			apartment that is four blocks away than one that is fifteen. However, if the same subway line is above ground, 
			it could depreciate the value of apartments 
			that are only steps away. </p>
			<p>Traditional calculations, like 'median sales price', operate on scales more comparable to the size of a school district rather than to the
			distances that are meaningful in cities - like subway proximity. How will the distance to a nearby park or restaurant effect a property's value? </p>
			<p>Enter City Property</p>
			<p> By looking at changes in sales prices over time and simultaneously looking at changes over smaller
			areas - on the scale of city blocks instead of traditional neighborhood or county lines, we can gain a much better sense of the value tied to
			 a specific location and how that value is changing over time.</p>
			 <h3>Case Study: New York City</h3>
			<p>New York City's Department of Finance tracks the sale of every property in each of the five boroughs, and the 
			 Department of Planning has GPS coordinates for each city parcel; all of this 
			 data has been made publicly available. Since 2003, NYC has logged over 1.2 million property sales.

			 <p> We'll begin by looking at the most recent property sales. Below is a heat map of all NYC properties sold in 2015. 
			 Freely Available Traditional Metrics Fall Short</p>
 

	<div class="row">
	<div class="col-md-11 col-lr-11 col-sm-11 col-xs-11">
		<p class="text-justify"></p>
	</div> <!-- end <div class="col-md-12"> -->
	</div> <!-- end <div class="row"> -->



			<P>From the heat map above, and from the tables in the links below, we can see that properties were sold throughout the whole of each of the
			 five boroughs in 2015 and the volume of sales in each borough has been on a slowing upward trend since 2010, while the median property 
			 value has continued to increase significantly. </p>
 
			 <p> By tying together the sales price of
			 each property to its GPS coordinates, we can construct a simple preliminary model that predicts a property's value based upon its location. The following model
			 is based upon a k-nearest neighbors machine learning algorithm. 
			</p>


<div class="container">
<div class="row">
<div class="col-md-6 col-lg-6">

	<h4><a href="#col1Content" data-toggle="collapse">Median Sales Prices</a></h4>
	
<div id="col1Content" class="collapse">
		<!-- The table class adds nice spacing and the other classes add additional style -->
		<table class="table table-bordered table-striped table-hover">
			<thead>
				<tr>
					 <td colspan="6" class="text-center">Median Sales Price By Borough (in thousands)</td>
				</tr>
			</thead>
			<tbody>
				  <tr>
				  <!-- You can adjust the width of table columns as well -->
				  <th class="col-md-2"></td>
 
				  <!-- Use text alignment like text-center or text-right -->
				  <th class="text-center">Manhattan</td>
				  <th class="text-center">Bronx</td>
				  <th class="text-center">Brooklyn</td>
				  <th class="text-center">Queens</td>
				  <th class="text-center">Staten Island</td>
				  </tr>
	  
					<tr>
					<td><a href='#'>2003</a></td>
					<td>406.8</td>
					<td>277.0</td>
					<td>328.3</td>
					<td>305.0</td>
					<td>314.4</td>
					</tr>
					<tr>
					<td><a href='#'>2004</a></td>
					<td>495.0</td>
					<td>325.0</td>
					<td>385.0</td>
					<td>358.0</td>
					<td>356.0</td>
					</tr>
					<tr>
					<td><a href='#'>2005</a></td>
					<td>611.5</td>
					<td>381.0</td>
					<td>469.4</td>
					<td>427.0</td>
					<td>407.3</td>
					</tr>
					<tr>
					<td><a href='#'>2006</a></td>
					<td>630.8</td>
					<td>450.0</td>
					<td>550.0</td>
					<td>480.0</td>
					<td>440.0</td>
					</tr>
					<tr>
					<td><a href='#'>2007</a></td>
					<td>650.0</td>
					<td>460.0</td>
					<td>565.0</td>
					<td>478.0</td>
					<td>435.0</td>
					</tr>
					<tr>
					<td><a href='#'>2008</a></td>
					<td>590.0</td>
					<td>390.0</td>
					<td>530.0</td>
					<td>420.0</td>
					<td>405.0</td>
					</tr>
					<tr>
					<td><a href='#'>2009</a></td>
					<td>500.0</td>
					<td>340.0</td>
					<td>460.0</td>
					<td>365.0</td>
					<td>380.0</td>
					</tr>
					<tr>
					<td><a href='#'>2010</a></td>
					<td>450.0</td>
					<td>375.0</td>
					<td>500.0</td>
					<td>400.0</td>
					<td>395.0</td>
					</tr>
					<tr>
					<td><a href='#'>2011</a></td>
					<td>557.0</td>
					<td>350.0</td>
					<td>465.2</td>
					<td>351.6</td>
					<td>380.0</td>
					</tr>
					<tr>
					<td><a href='#'>2012</a></td>
					<td>629.0</td>
					<td>347.0</td>
					<td>499.0</td>
					<td>371.5</td>
					<td>390.0</td>
					</tr>
					<tr>
					<td><a href='#'>2013</a></td>
					<td>635.0</td>
					<td>355.0</td>
					<td>517.0</td>
					<td>380.0</td>
					<td>397.4</td>
					</tr>
					<tr>
					<td><a href='#'>2014</a></td>
					<td>699.0</td>
					<td>375.0</td>
					<td>580.0</td>
					<td>413.0</td>
					<td>409.2</td>
					</tr>
					<tr>
					<td><a href='#'>2015</a></td>
					<td>765.0</td>
					<td>390.0</td>
					<td>670.0</td>
					<td>438.0</td>
					<td>418.4</td>
					</tr>

     		</tbody>
   		 </table>
</div>
</div>
</div>

	<h4><a href="#col2Content" data-toggle="collapse">Sales Numbers By Borough</a></h4>
	<div class="col-md-6 col-lg-6">
		<div id="col2Content" class="collapse">

     	<!-- The table class adds nice spacing and the other classes add additional style -->
    	<table class="table table-bordered table-striped table-hover">
		   <thead>
				<tr>
				<td colspan="6" class="text-center">Number of Property Sales in Each Borough</td>
				</tr>
		   </thead>
		   <tbody>
				  <tr>
 
				  <!-- You can adjust the width of table columns as well -->
				  <th class="col-md-2"></td>
 
				  <!-- Use text alignment like text-center or text-right -->
				  <th class="text-center">Manhattan</td>
				  <th class="text-center">Bronx</td>
				  <th class="text-center">Brooklyn</td>
				  <th class="text-center">Queens</td>
				  <th class="text-center">Staten Island</td>

					<tr>
					<td><a href='#'>2003</a></td>
					<td>22210</td>
					<td>10664</td>
					<td>33706</td>
					<td>39177</td>
					<td>12671</td>
					</tr>
					<tr>
					<td><a href='#'>2004</a></td>
					<td>25894</td>
					<td>11807</td>
					<td>35048</td>
					<td>41199</td>
					<td>12643</td>
					</tr>
					<tr>
					<td><a href='#'>2005</a></td>
					<td>26388</td>
					<td>11805</td>
					<td>34243</td>
					<td>39937</td>
					<td>11270</td>
					</tr>
					<tr>
					<td><a href='#'>2006</a></td>
					<td>26352</td>
					<td>10695</td>
					<td>32146</td>
					<td>36482</td>
					<td>9797</td>
					</tr>
					<tr>
					<td><a href='#'>2007</a></td>
					<td>28439</td>
					<td>9269</td>
					<td>28643</td>
					<td>32032</td>
					<td>8626</td>
					</tr>
					<tr>
					<td><a href='#'>2008</a></td>
					<td>25994</td>
					<td>7057</td>
					<td>23791</td>
					<td>27097</td>
					<td>7208</td>
					</tr>
					<tr>
					<td><a href='#'>2009</a></td>
					<td>19166</td>
					<td>5243</td>
					<td>19995</td>
					<td>24060</td>
					<td>6531</td>
					</tr>
					<tr>
					<td><a href='#'>2010</a></td>
					<td>17296</td>
					<td>4755</td>
					<td>19649</td>
					<td>21198</td>
					<td>6138</td>
					</tr>
					<tr>
					<td><a href='#'>2011</a></td>
					<td>21500</td>
					<td>4963</td>
					<td>20726</td>
					<td>21580</td>
					<td>4756</td>
					</tr>
					<tr>
					<td><a href='#'>2012</a></td>
					<td>26258</td>
					<td>5151</td>
					<td>23492</td>
					<td>22949</td>
					<td>6231</td>
					</tr>
					<tr>
					<td><a href='#'>2013</a></td>
					<td>26715</td>
					<td>5932</td>
					<td>24842</td>
					<td>25415</td>
					<td>7070</td>
					</tr>
					<tr>
					<td><a href='#'>2014</a></td>
					<td>24524</td>
					<td>6208</td>
					<td>25361</td>
					<td>25157</td>
					<td>7437</td>
					</tr>
					<tr>
					<td><a href='#'>2015</a></td>
					<td>24989</td>
					<td>6736</td>
					<td>25362</td>
					<td>26354</td>
					<td>8005</td>
					</tr>
		</div>
     		</tbody>
    	</table>
</div>
</div>
</div>

</div>

 </div>
  <div class="container">
 <div class="row">

		<p>	Sorting out all of the local location-based contributions to city property values (parks, restaurants, shops, etc.) is a task 
			that has been glossed over by traditional metrics that often average values over large
			areas - such as a neighborhoods, counties, or zipcodes. There's probably a good reason for this: to understand small-scale influences, 
			a bunch of additional details  might need to be factored in to the standard calculations, and presumably, this was
			traditionally unfeasible. </p>
 
		<p>	Fortunately, we now have 21st-century computing power at our fingertips, and we can use machine learning to sort out 
			differences between two properties that might differ in location by only a two minute walk. 
		</p>

</div>
</div>
 
 

 	<div id="map"></div> <!--style="width: 600px; height: 400px"></div> --!>
   
   
    <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
    <script src="http://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
    <script src="https://d3js.org/d3.v4.min.js" data-semver="4.0.0" data-require="d3@*"></script>
 
    <script>
        var map = L.map('map').setView([40.705, -74.006], 10);
        mapLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; ' + mapLink + ' Contributors',
            maxZoom: 18,
        }).addTo(map);
        d3.csv('static/all_twenty15_sales.csv', function(error, dataset) {           // NEW, lat_long.csv
          dataset.forEach(function(d) {                             // NEW
            d.lat = +d.lat;                                     // NEW
            d.lon = +d.lon;                                     // NEW
            d.value = +d.value; 
            });                                                       // NEW
        	var heat = L.heatLayer(dataset,{
            	radius: 7.5,
            	blur: 15, 
            	maxZoom: 8,
        	}).addTo(map);
        });                                                         // NEW
    </script>      
 
  <div class="container">
 <div class="row">
<p>	Sorting out all of the local location-based contributions to city property values (parks, restaurants, shops, etc.) is a task 
			that has been glossed over by traditional metrics that often average values over large
			areas - such as a neighborhoods, counties, or zipcodes. There's probably a good reason for this: to understand small-scale influences, 
			a bunch of additional details  might need to be factored in to the standard calculations, and presumably, this was
			traditionally unfeasible. </p>
 
		<p>	Fortunately, we now have 21st-century computing power at our fingertips, and we can use machine learning to sort out 
			differences between two properties that might differ in location by only a two minute walk. 
		</p> 
</div>
</div>
 
 
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>

</body>
</html>        